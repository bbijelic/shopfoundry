<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
	   					   http://www.springframework.org/schema/beans/spring-beans.xsd">

	<!-- Service info provider -->
	<bean id="ServiceInfoProvider"
		class="org.shopfoundry.core.service.info.DefaultServiceInfoProvider">
		<!-- Service group -->
		<constructor-arg type="java.lang.String" value="EmailService" />
		<!-- Service version -->
		<constructor-arg type="java.lang.String" value="0.0.1" />
	</bean>

	<!-- Environment provider -->
	<bean id="EnvironmentProvider"
		class="org.shopfoundry.core.service.environment.DefaultEnvironmentProvider" />

	<!-- Guid Provider -->
	<bean id="GuidProvider" class="org.shopfoundry.core.service.guid.DefaultGuidProvider" />

	<!-- Certificate Manager -->
	<bean id="CertificateManager"
		class="org.shopfoundry.core.security.certificates.DefaultCertificateManager" />

	<!-- Security provider -->
	<bean id="SecurityProvider" class="org.shopfoundry.core.security.DefaultSecurityProvider">
		<constructor-arg ref="CertificateManager" />
	</bean>

	<!-- Service Registry Outbound Gateway -->
	<bean id="RegistryServiceOutboundGateway"
		class="org.shopfoundry.core.service.gateway.outbound.registry.DefaultRegistryOutboundGateway">
		<!-- Service Information Provider -->
		<constructor-arg ref="ServiceInfoProvider" />
		<!-- Security Manager provider -->
		<constructor-arg ref="SecurityProvider" />
		<!-- Registration Service URL -->
		<constructor-arg>
			<bean id="RegistryServiceUrl" class="java.lang.String">
				<constructor-arg value="https://localhost:8443/register" />
			</bean>
		</constructor-arg>
	</bean>

	<!-- Gateway provider -->
	<bean id="GatewayProvider"
		class="org.shopfoundry.core.service.gateway.DefaultGatewayProvider">
		<!-- Outbound gateways -->
		<constructor-arg>
			<map key-type="java.lang.String"
				value-type="org.shopfoundry.core.service.gateway.outbound.OutboundGateway">
				<entry key="RegistryService" value-ref="RegistryServiceOutboundGateway" />
			</map>
		</constructor-arg>
		<!-- Inbound gateways -->
		<constructor-arg>
			<map key-type="java.lang.String"
				value-type="org.shopfoundry.core.service.gateway.inbound.InboundGateway">
			</map>
		</constructor-arg>
	</bean>

	<!-- Service context -->
	<bean id="ServiceContext"
		class="org.shopfoundry.core.service.context.DefaultServiceContext">
		<constructor-arg ref="ServiceInfoProvider" />
		<constructor-arg ref="EnvironmentProvider" />
		<constructor-arg ref="GuidProvider" />
		<constructor-arg ref="SecurityProvider" />
		<constructor-arg ref="GatewayProvider" />
	</bean>

	<!-- Service state machine -->
	<bean id="ServiceStateMachine"
		class="org.shopfoundry.core.service.fsm.DefaultServiceStateMachine">
		<constructor-arg ref="ServiceContext" />
		<!-- State mapping -->
		<constructor-arg>
			<map key-type="org.shopfoundry.core.service.fsm.state.AllowedState"
				value-type="org.shopfoundry.core.service.fsm.state.ServiceState">
				<!-- Starting state -->
				<entry key="STARTING">
					<bean class="org.shopfoundry.core.service.fsm.state.StartingState" />
				</entry>
				<!-- Configuring state -->
				<entry key="CONFIGURING">
					<bean class="org.shopfoundry.core.service.fsm.state.ConfiguringState" />
				</entry>
				<!-- Running state -->
				<entry key="RUNNING">
					<bean class="org.shopfoundry.core.service.fsm.state.RunningState" />
				</entry>
				<!-- Shutting down state -->
				<entry key="SHUTTING_DOWN">
					<bean class="org.shopfoundry.core.service.fsm.state.ShuttingDownState" />
				</entry>
			</map>
		</constructor-arg>
	</bean>

	<!-- Service -->
	<bean id="Service" class="org.shopfoundry.services.email.EmailDispatcherService">
		<constructor-arg ref="ServiceContext" />
		<constructor-arg ref="ServiceStateMachine" />
	</bean>

</beans>